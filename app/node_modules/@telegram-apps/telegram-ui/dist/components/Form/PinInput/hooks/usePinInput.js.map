{"version":3,"sources":["../../../../../src/components/Form/PinInput/hooks/usePinInput.ts"],"sourcesContent":["'use client';\n\nimport { useCallback, useRef } from 'react';\n\nimport { Keys } from 'helpers/accessibility';\nimport { clamp } from 'helpers/math';\nimport { useCustomEnsuredControl } from 'hooks/useEnsureControl';\n\ninterface UsePinInputProps {\n  pinCount: number;\n  value?: number[];\n  onChange?(value: number[]): void;\n}\n\nexport const AVAILABLE_PINS = [1, 2, 3, 4, 5, 6, 7, 8, 9, 0, Keys.BACKSPACE];\n\nexport const usePinInput = ({\n  pinCount,\n  value: valueProp = [],\n  onChange,\n}: UsePinInputProps) => {\n  const inputRefs = useRef<HTMLLabelElement[]>([]).current;\n  const [value, setValue] = useCustomEnsuredControl({\n    defaultValue: valueProp,\n    onChange,\n  });\n\n  const focusByIndex = (index: number) => {\n    requestAnimationFrame(() => inputRefs[index]?.focus());\n  };\n\n  const setValueByIndex = (index: number, newValue: number) => {\n    setValue((prev) => {\n      const nextValue = [...prev];\n      nextValue[index] = newValue;\n      return nextValue;\n    });\n  };\n\n  const removeLastValue = (currentIndex: number) => {\n    setValue((prev) => prev.slice(0, -1));\n    focusByIndex(currentIndex - 1);\n  };\n\n  const handleClickValue = useCallback((enteredValue: number) => {\n    const lastIndex = clamp(value.length, 0, pinCount - 1);\n    setValueByIndex(lastIndex, enteredValue);\n    focusByIndex(lastIndex + 1);\n  }, [value, pinCount]);\n\n  const handleClickBackspace = useCallback(() => {\n    removeLastValue(value.length - 1);\n  }, [value]);\n\n  const handleButton = useCallback((index: number, button: string) => {\n    if (AVAILABLE_PINS.includes(Number(button))) {\n      setValueByIndex(index, Number(button));\n      focusByIndex(index + 1);\n    }\n\n    switch (button) {\n      case Keys.BACKSPACE:\n        removeLastValue(index);\n        break;\n\n      case Keys.ARROW_LEFT:\n        focusByIndex(index - 1);\n        break;\n\n      case Keys.ARROW_RIGHT:\n        focusByIndex(index + 1);\n        break;\n\n      default:\n        break;\n    }\n  }, []);\n\n  const setInputRefByIndex = useCallback((index: number, ref: HTMLLabelElement | null) => {\n    if (!ref) {\n      return;\n    }\n\n    inputRefs[index] = ref;\n  }, []);\n\n  return {\n    value,\n    setInputRefByIndex,\n    handleClickValue,\n    handleClickBackspace,\n    handleButton,\n  };\n};\n"],"names":["useCallback","useRef","Keys","clamp","useCustomEnsuredControl","AVAILABLE_PINS","BACKSPACE","usePinInput","pinCount","value","valueProp","onChange","inputRefs","current","setValue","defaultValue","focusByIndex","index","requestAnimationFrame","focus","setValueByIndex","newValue","prev","nextValue","removeLastValue","currentIndex","slice","handleClickValue","enteredValue","lastIndex","length","handleClickBackspace","handleButton","button","includes","Number","ARROW_LEFT","ARROW_RIGHT","setInputRefByIndex","ref"],"mappings":"AAAA;AAEA,SAASA,WAAW,EAAEC,MAAM,QAAQ,QAAQ;AAE5C,SAASC,IAAI,QAAQ,oCAAwB;AAC7C,SAASC,KAAK,QAAQ,2BAAe;AACrC,SAASC,uBAAuB,QAAQ,qCAAyB;AAQjE,OAAO,MAAMC,iBAAiB;IAAC;IAAG;IAAG;IAAG;IAAG;IAAG;IAAG;IAAG;IAAG;IAAG;IAAGH,KAAKI,SAAS;CAAC,CAAC;AAE7E,OAAO,MAAMC,cAAc,CAAC,EAC1BC,QAAQ,EACRC,OAAOC,YAAY,EAAE,EACrBC,QAAQ,EACS;IACjB,MAAMC,YAAYX,OAA2B,EAAE,EAAEY,OAAO;IACxD,MAAM,CAACJ,OAAOK,SAAS,GAAGV,wBAAwB;QAChDW,cAAcL;QACdC;IACF;IAEA,MAAMK,eAAe,CAACC;QACpBC,sBAAsB;gBAAMN;oBAAAA,mBAAAA,SAAS,CAACK,MAAM,cAAhBL,uCAAAA,iBAAkBO,KAAK;;IACrD;IAEA,MAAMC,kBAAkB,CAACH,OAAeI;QACtCP,SAAS,CAACQ;YACR,MAAMC,YAAY;mBAAID;aAAK;YAC3BC,SAAS,CAACN,MAAM,GAAGI;YACnB,OAAOE;QACT;IACF;IAEA,MAAMC,kBAAkB,CAACC;QACvBX,SAAS,CAACQ,OAASA,KAAKI,KAAK,CAAC,GAAG,CAAC;QAClCV,aAAaS,eAAe;IAC9B;IAEA,MAAME,mBAAmB3B,YAAY,CAAC4B;QACpC,MAAMC,YAAY1B,MAAMM,MAAMqB,MAAM,EAAE,GAAGtB,WAAW;QACpDY,gBAAgBS,WAAWD;QAC3BZ,aAAaa,YAAY;IAC3B,GAAG;QAACpB;QAAOD;KAAS;IAEpB,MAAMuB,uBAAuB/B,YAAY;QACvCwB,gBAAgBf,MAAMqB,MAAM,GAAG;IACjC,GAAG;QAACrB;KAAM;IAEV,MAAMuB,eAAehC,YAAY,CAACiB,OAAegB;QAC/C,IAAI5B,eAAe6B,QAAQ,CAACC,OAAOF,UAAU;YAC3Cb,gBAAgBH,OAAOkB,OAAOF;YAC9BjB,aAAaC,QAAQ;QACvB;QAEA,OAAQgB;YACN,KAAK/B,KAAKI,SAAS;gBACjBkB,gBAAgBP;gBAChB;YAEF,KAAKf,KAAKkC,UAAU;gBAClBpB,aAAaC,QAAQ;gBACrB;YAEF,KAAKf,KAAKmC,WAAW;gBACnBrB,aAAaC,QAAQ;gBACrB;YAEF;gBACE;QACJ;IACF,GAAG,EAAE;IAEL,MAAMqB,qBAAqBtC,YAAY,CAACiB,OAAesB;QACrD,IAAI,CAACA,KAAK;YACR;QACF;QAEA3B,SAAS,CAACK,MAAM,GAAGsB;IACrB,GAAG,EAAE;IAEL,OAAO;QACL9B;QACA6B;QACAX;QACAI;QACAC;IACF;AACF,EAAE"}