{"version":3,"sources":["../../../../../../src/components/Form/PinInput/hooks/usePinInput.ts"],"sourcesContent":["'use client';\n\nimport { useCallback, useRef } from 'react';\n\nimport { Keys } from 'helpers/accessibility';\nimport { clamp } from 'helpers/math';\nimport { useCustomEnsuredControl } from 'hooks/useEnsureControl';\n\ninterface UsePinInputProps {\n  pinCount: number;\n  value?: number[];\n  onChange?(value: number[]): void;\n}\n\nexport const AVAILABLE_PINS = [1, 2, 3, 4, 5, 6, 7, 8, 9, 0, Keys.BACKSPACE];\n\nexport const usePinInput = ({\n  pinCount,\n  value: valueProp = [],\n  onChange,\n}: UsePinInputProps) => {\n  const inputRefs = useRef<HTMLLabelElement[]>([]).current;\n  const [value, setValue] = useCustomEnsuredControl({\n    defaultValue: valueProp,\n    onChange,\n  });\n\n  const focusByIndex = (index: number) => {\n    requestAnimationFrame(() => inputRefs[index]?.focus());\n  };\n\n  const setValueByIndex = (index: number, newValue: number) => {\n    setValue((prev) => {\n      const nextValue = [...prev];\n      nextValue[index] = newValue;\n      return nextValue;\n    });\n  };\n\n  const removeLastValue = (currentIndex: number) => {\n    setValue((prev) => prev.slice(0, -1));\n    focusByIndex(currentIndex - 1);\n  };\n\n  const handleClickValue = useCallback((enteredValue: number) => {\n    const lastIndex = clamp(value.length, 0, pinCount - 1);\n    setValueByIndex(lastIndex, enteredValue);\n    focusByIndex(lastIndex + 1);\n  }, [value, pinCount]);\n\n  const handleClickBackspace = useCallback(() => {\n    removeLastValue(value.length - 1);\n  }, [value]);\n\n  const handleButton = useCallback((index: number, button: string) => {\n    if (AVAILABLE_PINS.includes(Number(button))) {\n      setValueByIndex(index, Number(button));\n      focusByIndex(index + 1);\n    }\n\n    switch (button) {\n      case Keys.BACKSPACE:\n        removeLastValue(index);\n        break;\n\n      case Keys.ARROW_LEFT:\n        focusByIndex(index - 1);\n        break;\n\n      case Keys.ARROW_RIGHT:\n        focusByIndex(index + 1);\n        break;\n\n      default:\n        break;\n    }\n  }, []);\n\n  const setInputRefByIndex = useCallback((index: number, ref: HTMLLabelElement | null) => {\n    if (!ref) {\n      return;\n    }\n\n    inputRefs[index] = ref;\n  }, []);\n\n  return {\n    value,\n    setInputRefByIndex,\n    handleClickValue,\n    handleClickBackspace,\n    handleButton,\n  };\n};\n"],"names":["AVAILABLE_PINS","usePinInput","Keys","BACKSPACE","pinCount","value","valueProp","onChange","inputRefs","useRef","current","setValue","useCustomEnsuredControl","defaultValue","focusByIndex","index","requestAnimationFrame","focus","setValueByIndex","newValue","prev","nextValue","removeLastValue","currentIndex","slice","handleClickValue","useCallback","enteredValue","lastIndex","clamp","length","handleClickBackspace","handleButton","button","includes","Number","ARROW_LEFT","ARROW_RIGHT","setInputRefByIndex","ref"],"mappings":"AAAA;;;;;;;;;;;;IAcaA,cAAc;eAAdA;;IAEAC,WAAW;eAAXA;;;uBAduB;+BAEf;sBACC;kCACkB;AAQjC,MAAMD,iBAAiB;IAAC;IAAG;IAAG;IAAG;IAAG;IAAG;IAAG;IAAG;IAAG;IAAG;IAAGE,mBAAI,CAACC,SAAS;CAAC;AAErE,MAAMF,cAAc,CAAC,EAC1BG,QAAQ,EACRC,OAAOC,YAAY,EAAE,EACrBC,QAAQ,EACS;IACjB,MAAMC,YAAYC,IAAAA,aAAM,EAAqB,EAAE,EAAEC,OAAO;IACxD,MAAM,CAACL,OAAOM,SAAS,GAAGC,IAAAA,yCAAuB,EAAC;QAChDC,cAAcP;QACdC;IACF;IAEA,MAAMO,eAAe,CAACC;QACpBC,sBAAsB;gBAAMR;oBAAAA,mBAAAA,SAAS,CAACO,MAAM,cAAhBP,uCAAAA,iBAAkBS,KAAK;;IACrD;IAEA,MAAMC,kBAAkB,CAACH,OAAeI;QACtCR,SAAS,CAACS;YACR,MAAMC,YAAY;mBAAID;aAAK;YAC3BC,SAAS,CAACN,MAAM,GAAGI;YACnB,OAAOE;QACT;IACF;IAEA,MAAMC,kBAAkB,CAACC;QACvBZ,SAAS,CAACS,OAASA,KAAKI,KAAK,CAAC,GAAG,CAAC;QAClCV,aAAaS,eAAe;IAC9B;IAEA,MAAME,mBAAmBC,IAAAA,kBAAW,EAAC,CAACC;QACpC,MAAMC,YAAYC,IAAAA,WAAK,EAACxB,MAAMyB,MAAM,EAAE,GAAG1B,WAAW;QACpDc,gBAAgBU,WAAWD;QAC3Bb,aAAac,YAAY;IAC3B,GAAG;QAACvB;QAAOD;KAAS;IAEpB,MAAM2B,uBAAuBL,IAAAA,kBAAW,EAAC;QACvCJ,gBAAgBjB,MAAMyB,MAAM,GAAG;IACjC,GAAG;QAACzB;KAAM;IAEV,MAAM2B,eAAeN,IAAAA,kBAAW,EAAC,CAACX,OAAekB;QAC/C,IAAIjC,eAAekC,QAAQ,CAACC,OAAOF,UAAU;YAC3Cf,gBAAgBH,OAAOoB,OAAOF;YAC9BnB,aAAaC,QAAQ;QACvB;QAEA,OAAQkB;YACN,KAAK/B,mBAAI,CAACC,SAAS;gBACjBmB,gBAAgBP;gBAChB;YAEF,KAAKb,mBAAI,CAACkC,UAAU;gBAClBtB,aAAaC,QAAQ;gBACrB;YAEF,KAAKb,mBAAI,CAACmC,WAAW;gBACnBvB,aAAaC,QAAQ;gBACrB;YAEF;gBACE;QACJ;IACF,GAAG,EAAE;IAEL,MAAMuB,qBAAqBZ,IAAAA,kBAAW,EAAC,CAACX,OAAewB;QACrD,IAAI,CAACA,KAAK;YACR;QACF;QAEA/B,SAAS,CAACO,MAAM,GAAGwB;IACrB,GAAG,EAAE;IAEL,OAAO;QACLlC;QACAiC;QACAb;QACAM;QACAC;IACF;AACF"}