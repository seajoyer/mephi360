{"version":3,"sources":["../../../../../../../src/components/Form/Multiselect/components/MultiselectBase/MultiselectBase.tsx"],"sourcesContent":["import {\n  forwardRef,\n  Fragment,\n  InputHTMLAttributes,\n  KeyboardEvent,\n  MouseEvent,\n  RefObject,\n} from 'react';\nimport styles from './MultiselectBase.module.css';\n\nimport { getHorizontalSideByKey, Keys } from 'helpers/accessibility';\nimport { classNames } from 'helpers/classNames';\nimport { getHTMLElementByChildren, getHTMLElementSiblingByDirection } from 'helpers/dom';\nimport { useExternRef } from 'hooks/useExternalRefs';\n\nimport { isHTMLElement } from '@floating-ui/utils/dom';\nimport { Icon16Cancel } from 'icons/16/cancel';\n\nimport { ChipProps } from 'components/Form/Chip/Chip';\nimport { MultiselectOption } from 'components/Form/Multiselect/types';\nimport { Tappable } from 'components/Service/Tappable/Tappable';\nimport { Subheadline } from 'components/Typography/Subheadline/Subheadline';\nimport { getValueOptionByHTMLElement } from './helpers/getValueOptionByHTMLElement';\nimport { renderChipDefault } from './constants';\n\nexport interface MultiselectBaseProps extends InputHTMLAttributes<HTMLInputElement> {\n  /** Custom function to render Chip component. */\n  renderChip?: (props: ChipProps) => JSX.Element;\n  /** Ref to the input element within the multiselect base. */\n  inputRef: RefObject<HTMLInputElement>;\n  /** Array of selected options (chips). */\n  chipsValue: MultiselectOption[];\n  /** Callback function to add an option based on text input. */\n  onAddChipOption: (optionText: string) => void;\n  /** Callback function to remove a selected chip. */\n  onRemoveChipOption: (option: MultiselectOption) => void;\n}\n\n/**\n * Renders the base layout of the multiselect including the chips (selected options) and the input field.\n */\nexport const MultiselectBase = forwardRef<HTMLDivElement, MultiselectBaseProps>(({\n  inputRef,\n  className,\n\n  // Option props\n  chipsValue,\n  onAddChipOption,\n  onRemoveChipOption,\n  renderChip = renderChipDefault,\n\n  // Input props\n  value,\n  placeholder,\n  disabled,\n  readOnly,\n  ...restProps\n}, ref) => {\n  const listRef = useExternRef<HTMLDivElement>(ref);\n\n  const valueLength = chipsValue.length;\n  const withPlaceholder = valueLength === 0;\n  const isDisabled = disabled || readOnly;\n\n  const handleKeyDown = (event: KeyboardEvent<HTMLDivElement>) => {\n    const targetEl = event.target;\n    const inputEl = inputRef.current;\n\n    if (event.defaultPrevented || !inputEl || !isHTMLElement(targetEl)) {\n      return;\n    }\n\n    const lastOptionIndex = valueLength - 1;\n\n    const nextInputValue = inputEl.value;\n    const isInputEl = targetEl === inputEl;\n    const isInputValueEmpty = nextInputValue === '';\n\n    switch (event.key) {\n      case Keys.ENTER: {\n        if (isInputEl && !isInputValueEmpty) {\n          event.preventDefault();\n          onAddChipOption(nextInputValue);\n        }\n        break;\n      }\n\n      case Keys.BACKSPACE: {\n        if (valueLength) {\n          const option =\n            isInputEl && isInputValueEmpty\n              ? chipsValue[lastOptionIndex]\n              : getValueOptionByHTMLElement(chipsValue, targetEl);\n\n          if (!option) {\n            return;\n          }\n\n          event.preventDefault();\n          inputRef.current.focus();\n          onRemoveChipOption(option);\n        }\n        break;\n      }\n\n      case Keys.ARROW_UP:\n      case Keys.ARROW_LEFT:\n      case Keys.ARROW_DOWN:\n      case Keys.ARROW_RIGHT: {\n        if (!valueLength || !listRef.current) {\n          break;\n        }\n\n        const isSelectionOnFirstLetter = inputEl.selectionStart === 0;\n        const isRightSelection = event.key === Keys.ARROW_RIGHT && isSelectionOnFirstLetter;\n\n        if (!isInputValueEmpty && !isSelectionOnFirstLetter || isRightSelection) {\n          break;\n        }\n\n        event.preventDefault();\n        let foundEl: HTMLElement | null = null;\n        const horizontalSide = getHorizontalSideByKey(event.key);\n\n        if (isInputEl && (event.key === Keys.ARROW_UP || event.key === Keys.ARROW_LEFT)) {\n          foundEl = getHTMLElementByChildren(listRef.current.children, lastOptionIndex);\n        } else if (horizontalSide) {\n          foundEl = getHTMLElementSiblingByDirection(targetEl, horizontalSide);\n        }\n\n        foundEl && foundEl.focus();\n        break;\n      }\n\n      default:\n        break;\n    }\n  };\n\n  const handleChipRemove = (event: MouseEvent, optionToRemove: MultiselectOption) => {\n    event.preventDefault();\n    event.stopPropagation();\n    onRemoveChipOption(optionToRemove);\n  };\n\n  const handleClick = () => {\n    const isFocused = document.activeElement === inputRef.current;\n    if (!isFocused && inputRef.current) {\n      inputRef.current.focus();\n    }\n  };\n\n  return (\n    // eslint-disable-next-line jsx-a11y/interactive-supports-focus\n    <div\n      ref={listRef}\n      className={classNames(\n        styles.wrapper,\n        withPlaceholder && styles['wrapper--withPlaceholder'],\n        className,\n      )}\n      onClick={isDisabled ? undefined : handleClick}\n      role=\"listbox\"\n      aria-orientation=\"horizontal\"\n      aria-disabled={disabled}\n      aria-readonly={readOnly}\n      onKeyDown={isDisabled ? undefined : handleKeyDown}\n    >\n      {chipsValue.map((option, index) => (\n        <Fragment key={`${typeof option.value}-${option.label}`}>\n          {renderChip(\n            {\n              children: option.label,\n              className: styles.chip,\n              value: option.value,\n              tabIndex: -1,\n              after: (\n                <Tappable\n                  Component=\"div\"\n                  interactiveAnimation=\"opacity\"\n                  onClick={(event) => handleChipRemove(event, option)}\n                  className={styles.closeIcon}\n                >\n                  <Icon16Cancel />\n                </Tappable>\n              ),\n              role: 'option',\n              'aria-selected': true,\n              'aria-posinset': index + 1,\n              'aria-setsize': valueLength,\n            },\n          )}\n        </Fragment>\n      ))}\n      <Subheadline\n        ref={inputRef}\n        aria-autocomplete=\"list\"\n        autoCapitalize=\"none\"\n        autoComplete=\"off\"\n        autoCorrect=\"off\"\n        spellCheck={false}\n        {...restProps}\n        Component=\"input\"\n        type=\"text\"\n        className={styles.input}\n        disabled={disabled}\n        readOnly={readOnly}\n        placeholder={withPlaceholder ? placeholder : undefined}\n      />\n    </div>\n  );\n});\n"],"names":["MultiselectBase","forwardRef","ref","inputRef","className","chipsValue","onAddChipOption","onRemoveChipOption","renderChip","renderChipDefault","value","placeholder","disabled","readOnly","restProps","listRef","useExternRef","valueLength","length","withPlaceholder","isDisabled","handleKeyDown","event","targetEl","target","inputEl","current","defaultPrevented","isHTMLElement","lastOptionIndex","nextInputValue","isInputEl","isInputValueEmpty","key","Keys","ENTER","preventDefault","BACKSPACE","option","getValueOptionByHTMLElement","focus","ARROW_UP","ARROW_LEFT","ARROW_DOWN","ARROW_RIGHT","isSelectionOnFirstLetter","selectionStart","isRightSelection","foundEl","horizontalSide","getHorizontalSideByKey","getHTMLElementByChildren","children","getHTMLElementSiblingByDirection","handleChipRemove","optionToRemove","stopPropagation","handleClick","isFocused","document","activeElement","div","classNames","onClick","undefined","role","aria-orientation","aria-disabled","aria-readonly","onKeyDown","map","index","Fragment","label","tabIndex","after","Tappable","Component","interactiveAnimation","Icon16Cancel","Subheadline","aria-autocomplete","autoCapitalize","autoComplete","autoCorrect","spellCheck","type"],"mappings":"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"}